# This flow requires passing some parameters:
#  MAESTRO_STORE environment variable. app_store or test_store. Defaults to test_store.
#  MAESTRO_EXPECTED_VERIFICATION_RESULT environment variable.
#  MAESTRO_EXPECTED_CUSTOMER_INFO_SOURCE environment variable.
# Example:
# maestro test -e MAESTRO_STORE=test_store -e MAESTRO_EXPECTED_VERIFICATION_RESULT=verified -e MAESTRO_EXPECTED_CUSTOMER_INFO_SOURCE=main subscribe_from_v2_paywall.yaml

appId: com.revenuecat.maestro.ios
name: Subscribe to product through V2 Paywall for default offering

---
- clearState
- launchApp:
    arguments:
        e2e_test_flow: subscribe_from_v2_paywall
- assertVisible: "entitlement (pro): nil"
- tapOn:
    text: "Present Paywall"
- assertVisible: "Paywall V2"
- takeScreenshot: "subscribe_from_v2_paywall - Paywall"
- tapOn:
    text: "Yearly"
- tapOn:
    text: "Continue"
- runFlow:
    file: ../utils/confirm_purchase.yaml
    env:
      SCREENSHOT_PREFIX: subscribe_from_v2_paywall
- assertVisible: "entitlement (pro): active"
- takeScreenshot: "subscribe_from_v2_paywall - unlocked entitlement"
- assertVisible: "verification: ${MAESTRO_EXPECTED_VERIFICATION_RESULT}"
- assertVisible: "customer info source: ${MAESTRO_EXPECTED_CUSTOMER_INFO_SOURCE}"